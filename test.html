<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Learn D3</title>
    <script src="js/d3/d3.js"></script>
    <link rel="stylesheet" href="css/chartStyle.css">
    <!--<link rel="stylesheet" href="css/bootstrap/bootstrap.min.css">-->
    <!--<script src="js/bootstrap/jquery-3.3.1.min.js"></script>-->
    <!--<script src="js/bootstrap/popper.min.js"></script>-->
    <!--<script src="js/bootstrap/bootstrap.min.js"></script>-->
</head>
<body>

<div style="width: 1024px;height: 800px;margin-left: auto;margin-right: auto;margin-top: 50px" id="tcharts">
</div>

<div id="transition_demo" style="width: 400px;height: 400px"></div>


<script>

    // 画布大小
    let width=1024;
    let height=1024;
    // 矩形大小
    let rectHeight=40;
    // 矩形间距
    let rectPadding=4;
    // 间距
    let padding={left:50,right:50,top:20,bottom:20};

    let dataset=[20,30,40,10,80];
    let city=["金华","义乌","宁波","绍兴","杭州"];

    let svg=d3.select("#tcharts").append("svg").attr("width",width).attr("height",height);

    // X轴比例尺
    let x_scale=d3.scaleLinear().domain([0,d3.max(dataset)]).range([0,width-100]);
    // Y轴比例尺
    let y_scale=d3.scaleBand()
        .domain(city)
        .range([0,rectHeight*dataset.length])
        .paddingInner(0.3)
        .paddingOuter(0);

    // 画矩形
    svg.selectAll(".MyRect")
        .data(dataset)
        .enter()
        .append("rect")
        .attr("class","MyRect")
        .attr("x",padding.left)
        .attr("y",function (d, i) {
            return i*rectHeight;
        })
        .attr("height",rectHeight-2)
        .attr("fill","steelblue")
        .attr("width",0)
        .transition()
        .delay(function (d, i) {
            return i*200;
        })
        .duration(2000)
        .attr("width",function (d) {
            return x_scale(d)
        });

    // 两个坐标轴
    svg.append("g")
        .attr('transform', `translate(50, 200)`)
        .call(d3.axisBottom(x_scale));

    svg.append("g")
        .attr('transform', `translate(40, 0)`)
        .attr("class","axis-label")
        .call(d3.axisLeft(y_scale));

    // 添加文字元素
    svg.selectAll(".MyText")
        .data(dataset)
        .enter()
        .append("text")
        .attr("class","MyText")
        .attr("fill","white")
        .attr("y",function (d, i) {
            return 24+i*rectHeight;
        })
        .text(function (d) {
            return d;
        })
        .attr("x",function (d) {
            return 50;
        })
        .transition()
        .delay(function (d, i) {
            return i*200;
        })
        .duration(2000)
        .attr("x",function (d) {
            return padding.left+x_scale(d)-30;
        });

    // 动画demo
    let currentdate="1";
    let anim_svg=d3.select("#transition_demo").append("svg").attr("width",400).attr("height",400);
    const g = anim_svg.append('g')
        .attr('transform', `translate(0,0)`);
    var dateLabel = g.append("text")
        .data(currentdate)
        .attr("class", "dateLabel")
        .attr("x", 390)
        .attr("y", 390)
        .attr("text-anchor", "end")
        .text(currentdate);

    dateLabel
        .transition()
        .duration(2000)
        .tween("anim",function(){
            let self=this;
            let i=d3.interpolateRound(0,100);
            return function (t) {
                self.textContent=i(t);
            }
        });

</script>
</body>
</html>